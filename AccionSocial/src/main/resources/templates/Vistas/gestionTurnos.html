<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Gestión de Turnos</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        .badge-pendiente { background-color: #ffc107; color: #000; }
        .badge-confirmado { background-color: #0dcaf0; color: #000; }
        .badge-cancelado { background-color: #dc3545; }
        .badge-completado { background-color: #198754; }
        
        .turno-hoy {
            background-color: #fff3cd;
        }
        
        .turno-pasado {
            opacity: 0.7;
        }
    </style>
</head>
<body class="bg-light">
<div class="container mt-5">
    <div class="card shadow p-4">
        <div class="d-flex justify-content-between align-items-center mb-4">
            <h3 class="m-0">Gestión de Turnos</h3>
            <a th:href="@{/mostrarlista}" class="btn btn-secondary">Ver Casos</a>
        </div>
        
        <!-- Filtros -->
        <div class="row mb-4">
            <div class="col-md-12">
                <div class="btn-group" role="group">
                    <button type="button" class="btn btn-outline-primary" onclick="filtrarPorEstado('todos')">Todos</button>
                    <button type="button" class="btn btn-outline-warning" onclick="filtrarPorEstado('Pendiente')">Pendientes</button>
                    <button type="button" class="btn btn-outline-info" onclick="filtrarPorEstado('Confirmado')">Confirmados</button>
                    <button type="button" class="btn btn-outline-success" onclick="filtrarPorEstado('Completado')">Completados</button>
                    <button type="button" class="btn btn-outline-danger" onclick="filtrarPorEstado('Cancelado')">Cancelados</button>
                </div>
            </div>
        </div>
        
        <!-- Tabla de Turnos -->
        <div th:if="${turnos != null and !turnos.isEmpty()}">
            <div class="table-responsive">
                <table class="table table-bordered table-striped align-middle" id="tablaTurnos">
                    <thead class="table-dark">
                        <tr>
                            <th>N°Caso</th>
                            <th>Nombre</th>
                            <th>Apellido</th>
                            <th>DNI</th>
                            <th>Estado</th>
                            <th>Motivo</th>
                            <th>Acciones</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr th:each="t : ${turnos}" 
                            th:attr="data-estado=${t.estado}"
                            th:classappend="${#temporals.format(t.fecha, 'yyyy-MM-dd') == #temporals.format(#temporals.createNow(), 'yyyy-MM-dd')} ? 'turno-hoy' : ''">
                            <td th:text="${#temporals.format(t.fecha, 'dd/MM/yyyy')}"></td>
                            <td th:text="${#temporals.format(t.hora, 'HH:mm')}"></td>
                            <td th:text="${t.caso.nombre + ' ' + t.caso.apellido}"></td>
                            <td th:text="${t.caso.dni}"></td>
                            <td th:text="${t.caso.numeroCaso}"></td>
                            <td th:text="${t.motivo}"></td>
                            <td>
                                <span class="badge" 
                                      th:classappend="${'badge-' + #strings.toLowerCase(t.estado)}"
                                      th:text="${t.estado}"></span>
                            </td>
                            <td th:text="${t.observaciones}"></td>
                            <td>
                                <div class="btn-group btn-group-sm" role="group">
                                    <a th:href="@{/turnos/caso/{id}(id=${t.caso.id})}" 
                                       class="btn btn-primary"
                                       title="Ver turnos del caso">
                                        Ver Beneficios
                                    </a>
									<a th:href="@{/turnos/caso/{id}(id=${t.caso.id})}" 
									                                   class="btn btn-primary"
									                                   title="Ver turnos del caso">
									                                    Aprovado
									                                </a>
                                    <a th:href="@{/turnos/editar/{id}(id=${t.id})}" 
                                       class="btn btn-warning"
                                       title="Editar turno">
                                        Editar
                                    </a>
                                    <a th:href="@{/turnos/eliminar/{id}(id=${t.id})}" 
                                       class="btn btn-danger"
                                       onclick="return confirm('¿Seguro que desea eliminar este turno?');"
                                       title="Eliminar turno">
                                        Eliminar
                                    </a>
                                </div>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
        
        <!-- Sin turnos -->
        <div th:if="${turnos == null or turnos.isEmpty()}" class="text-center text-muted mt-4">
            <p>No hay turnos registrados en el sistema.</p>
        </div>
        
        <!-- Botones de navegación -->
        <div class="text-center mt-4">
            <a th:href="@{/mostrarlista}" class="btn btn-secondary">Volver a Casos</a>
        </div>
    </div>
</div>

<script>
    function filtrarPorEstado(estado) {
        const filas = document.querySelectorAll('#tablaTurnos tbody tr');
        
        filas.forEach(fila => {
            if (estado === 'todos') {
                fila.style.display = '';
            } else {
                const estadoFila = fila.getAttribute('data-estado');
                if (estadoFila === estado) {
                    fila.style.display = '';
                } else {
                    fila.style.display = 'none';
                }
            }
        });
    }
</script>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>